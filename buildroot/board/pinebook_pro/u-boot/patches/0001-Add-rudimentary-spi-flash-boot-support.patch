From 39453f31508c238e218757e7b7da89a91beba640 Mon Sep 17 00:00:00 2001
From: Tobias Schramm <t.schramm@manjaro.org>
Date: Mon, 13 Apr 2020 18:49:57 +0200
Subject: [PATCH 1/2] Add rudimentary spi flash boot support

Signed-off-by: Tobias Schramm <t.schramm@manjaro.org>
---
 include/config_distro_bootcmd.h | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/include/config_distro_bootcmd.h b/include/config_distro_bootcmd.h
index fc0935fa21..0c5c9953de 100644
--- a/include/config_distro_bootcmd.h
+++ b/include/config_distro_bootcmd.h
@@ -67,6 +67,25 @@
 	BOOT_TARGET_DEVICES_references_MMC_without_CONFIG_CMD_MMC
 #endif
 
+#ifdef CONFIG_CMD_SF
+#define BOOTENV_SHARED_SF \
+		"sf_boot=if sf probe; then " \
+			"sf read ${scriptaddr} u-boot-script && "\
+			"source ${scriptaddr}; " \
+		"fi\0"
+#define BOOTENV_DEV_SF(devtypeu, devtypel, instance) \
+	"bootcmd_" #devtypel #instance "=" \
+		"devnum=" #instance "; " \
+		"run " #devtypel "_boot\0"
+#define BOOTENV_DEV_NAME_SF BOOTENV_DEV_NAME_BLKDEV
+#else
+#define BOOTENV_SHARED_MMC
+#define BOOTENV_DEV_SF \
+	BOOT_TARGET_DEVICES_references_SF_without_CONFIG_CMD_SF
+#define BOOTENV_DEV_NAME_SF \
+	BOOT_TARGET_DEVICES_references_SF_without_CONFIG_CMD_SF
+#endif
+
 #ifdef CONFIG_CMD_UBIFS
 #define BOOTENV_SHARED_UBIFS \
 	"ubifs_boot=" \
@@ -408,6 +427,7 @@
 #define BOOTENV \
 	BOOTENV_SHARED_HOST \
 	BOOTENV_SHARED_MMC \
+	BOOTENV_SHARED_SF \
 	BOOTENV_SHARED_PCI \
 	BOOTENV_SHARED_USB \
 	BOOTENV_SHARED_SATA \
-- 
2.26.0

